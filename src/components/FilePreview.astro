---
import { permalink } from "@/util/link";
import { readLocal, isText, isImage, getExt, isCode } from "@/util/files";

import Renderer from './Renderer.astro';

import DownloadIcon from '@/assets/icons/download.svg';

const { path, renderIfEmpty = true } = Astro.props;

const fileName: string = path.split('/').pop() ?? '/';
const ext: string = getExt(fileName);

const content = isCode(ext) || isText(ext) ? readLocal(path) : null;
const canRender = isImage(ext) || renderIfEmpty || content
---

{canRender && (
  <div class="file-actions">
    <pre class="file-name">{fileName}</pre>
    <a href={permalink(path)} class="btn btn-accent" download>
      <DownloadIcon class="size-[1.5em]" />
      Download
    </a>
  </div>

  <Renderer path={path} />
)}

<style>
  .file-actions {
    margin: 20px 0;
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .button {
    display: inline-block;
    padding: 8px 16px;
    background: #0070f3;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    width: max-content;
  }
  
  img {
    max-width: 100%;
    height: auto;
  }

  .file-name {
    width: 100%;
    font-weight: bold;
    font-size: large;
    margin: 0;
  }
</style>