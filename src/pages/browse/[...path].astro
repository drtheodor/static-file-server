---
import { getAllFiles } from '@/util/filescan';
import { type FileType } from '@/util/files';
import { browse } from "@/util/link";

import FilePreview from '@/components/FilePreview.astro';
import DirectoryPreview from '@/components/DirectoryPreview.astro';
import Layout from '@/layouts/Layout.astro';
import Search from '@/components/Search.astro';

import ChevronIcon from '@/assets/icons/chevron-right.svg';

export function getStaticPaths() {
  return getAllFiles();
}

interface Props {
  path: string,
  type: FileType,
}

const { path, type } = Astro.props;
---

<Layout title={`Viewing: ${path}`}>
  <div class="breadcrumbs text-sm">
    <ul>
      <li><ChevronIcon class="size-5 mr-1" /><a class="link link-accent" href={browse('/')}>~ / </a></li>
      {path.split('/').filter(Boolean).map((segment: string, i: number, arr: any[]) => {
          let pathSoFar = arr.slice(0, i + 1).join('/');

          if (i < arr.length - (type == 'file' ? 1 : 0)) pathSoFar += '/';

          return <li><a class="link link-accent" href={browse(pathSoFar)}>{segment}</a></li>;
      })}
    </ul>
  </div>

  <div class="divider">
    <Search />
  </div>


  {type == 'file' ? (
    <FilePreview path={path} />
  ) : (
    <DirectoryPreview path={path} /> 
  )}
</Layout>

